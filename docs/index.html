<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AnimeTosho Fast Subtitle Search</title>
  <style> /* Same as before, or your style.css */ </style>
</head>
<body>
  <h1>AnimeTosho Fast Subtitle Search</h1>
  <p>Daily updated • Search by name, Nyaa ID, language • Direct downloads</p>
  <input type="text" id="query" placeholder="Anime name or Nyaa ID">
  <select id="lang"><option value="">All Languages</option></select>
  <button onclick="search()">Search</button>
  <div id="status">Ready!</div>
  <div id="results"></div>

  <script>
    const API_URL = 'https://your-app.vercel.app/api';  // Your Vercel URL

    async function loadLanguages() {
      try {
        const resp = await fetch(`${API_URL}/languages`);
        const langs = await resp.json();
        const select = document.getElementById('lang');
        langs.forEach(l => {
          const opt = document.createElement('option');
          opt.value = l;
          opt.textContent = l.toUpperCase();
          select.appendChild(opt);
        });
      } catch (err) {
        document.getElementById('status').textContent = `Error loading languages: ${err.message}`;
      }
    }

    async function search() {
      const q = document.getElementById('query').value;
      const lang = document.getElementById('lang').value;
      const status = document.getElementById('status');
      status.textContent = 'Searching...';
      try {
        const url = `${API_URL}/search?q=${encodeURIComponent(q)}&lang=${lang}&limit=50`;
        const resp = await fetch(url);
        const data = await resp.json();
        display(data.results);
        status.textContent = `Found ${data.total} torrents (showing top 50)`;
      } catch (err) {
        status.textContent = `Error: ${err.message}`;
      }
    }

    function display(results) {
      const div = document.getElementById('results');
      if (!results.length) {
        div.innerHTML = '<p>No results</p>';
        return;
      }
      let html = '<table><tr><th>ID</th><th>Name</th><th>Languages</th><th>Downloads</th></tr>';
      results.forEach(r => {
        html += `<tr><td>${r.torrent_id}</td><td>${r.name}</td><td>${r.languages.join(', ')}</td><td>`;
        r.subtitle_files.forEach(sf => {
          sf.subs.forEach(s => html += `<a href="${s.url}" target="_blank">${s.lang.toUpperCase()}</a> `);
        });
        html += '</td></tr>';
      });
      html += '</table>';
      div.innerHTML = html;
    }

    loadLanguages();
  </script>
</body>
</html>
